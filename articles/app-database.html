<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="occupationMeasurement">
<title>Saving App Data in a Database • occupationMeasurement</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Saving App Data in a Database">
<meta property="og:description" content="occupationMeasurement">
<meta property="og:image" content="https://occupationmeasurement.github.io/occupationMeasurement/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">occupationMeasurement</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/occupationMeasurement.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/app.html">Using the Interactive App</a>
    <a class="dropdown-item" href="../articles/app-questionnaire.html">Custom Questionnaires / Pages</a>
    <a class="dropdown-item" href="../articles/app-database.html">Saving App Data in a Database</a>
    <a class="dropdown-item" href="../articles/app-deployment.html">Deploying to a Server / the Cloud</a>
    <a class="dropdown-item" href="../articles/api.html">Using the API</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/occupationMeasurement/occupationMeasurement/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Saving App Data in a Database</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/occupationMeasurement/occupationMeasurement/blob/HEAD/vignettes/app-database.Rmd" class="external-link"><code>vignettes/app-database.Rmd</code></a></small>
      <div class="d-none name"><code>app-database.Rmd</code></div>
    </div>

    
    
<p>Results from interactive occupation coding with the package via
<code><a href="../reference/app.html">app()</a></code> can easily be saved in a database by following this
guide.</p>
<p>The key feature to do this is by using <code>handle_data</code> in
<code><a href="../reference/create_app_settings.html">create_app_settings()</a></code>. This function will be called
whenever there is data to be saved by the package. Whenever it is
called, it’s called with the following arguments, with the function to
be called like this:
<code>handle_data(table_name, data, session)</code>.</p>
<p>Currently there are 4 different forms of <code>data</code> that are
being handled. These are differentiated by different
<code>table_name</code>(s).</p>
<ol style="list-style-type: decimal">
<li>
<code>table_name == "answers"</code>: The user’s answers themselves,
with one row per question. These are saved, whenever a page gets
submitted and therefore multiple times per participation.</li>
<li>
<code>table_name == "results_overview"</code>: A combined version of
the user’s answers and information about the user themselves. These are
saved at the end of the questionnaire and therefore only once per
participation.</li>
<li>
<code>table_name == "occupations_suggested"</code>: The list of
suggestions shown to the user. These are saved at the moment when
suggestions are generated and therefore <em>typically</em> once per
participation, but not necessarily.</li>
<li>
<code>table_name == "toggle_submitted"</code>: Information on when
and which suggestions were clicked to be expanded (or closed) by a
participant.</li>
<li>
<code>table_name == "session_info"</code>: Useful for understanding
whether some users may start multiple sessions in the app.</li>
<li>Any additional tables you might choose to save yourself if you
e.g. created a custom questionnaire.</li>
</ol>
<p>For a more detailed explanation of what data is being saved, check
out the section “Data” in <code><a href="../articles/app.html">vignette("app")</a></code>. The data you
find in the <code>csv</code> files saved by the app corresponds to the
<code>data</code> argument in <code>handle_data()</code>. It has to be
noted, however, that for some tables e.g. <code>answers</code>,
<code>handle_data()</code> will be called whenever a page is submitted
to also capture partial data.</p>
<p>The <code>session</code> being passed holds information on the
current <a href="https://shiny.rstudio.com/reference/shiny/latest/session.html" class="external-link">shiny
session</a> and can usually be ignored when it comes to saving data.</p>
<div class="section level2">
<h2 id="option-1-handling-all-data-the-same-way">Option 1: Handling all data the same way<a class="anchor" aria-label="anchor" href="#option-1-handling-all-data-the-same-way"></a>
</h2>
<p>Let’s automatically save data in a database, creating tables as we
need them.</p>
<p>We’re using
<code>[RSQLite](https://cran.r-project.org/web/packages/RSQLite/index.html)</code>
to connect to a SQLite in-memory database here for ease of use, but you
can easily substitute this using
<code>[RMariaDB](https://cran.r-project.org/web/packages/RMariaDB/index.html)</code>
for MySQL / MariaDB or
<code>[Rpostgres](https://cran.r-project.org/web/packages/RPostgres/index.html)</code>
for Postgres (check out the <a href="https://dbi.r-dbi.org/" class="external-link">documentation for DBI</a> for even more
options).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://occupationMeasurement.github.io/occupationMeasurement/" class="external-link">occupationMeasurement</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to the database</span></span>
<span><span class="va">db_connection</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch the interactive app</span></span>
<span><span class="fu"><a href="../reference/app.html">app</a></span><span class="op">(</span></span>
<span>  start <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  app_settings <span class="op">=</span> <span class="fu"><a href="../reference/create_app_settings.html">create_app_settings</a></span><span class="op">(</span></span>
<span>    handle_data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">table_name</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Write data into the database and automatically create the table if</span></span>
<span>      <span class="co"># it doesn't exist already</span></span>
<span>      <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbWriteTable</span><span class="op">(</span></span>
<span>        conn <span class="op">=</span> <span class="va">db_connection</span>,</span>
<span>        name <span class="op">=</span> <span class="va">table_name</span>,</span>
<span>        value <span class="op">=</span> <span class="va">data</span>,</span>
<span></span>
<span>        <span class="co"># Important, to actually add data and not remove any existing data.</span></span>
<span>        append <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Let's not save data in files, when we're already using a database</span></span>
<span>    save_to_file <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="option-2-handling-different-types-of-data-differently">Option 2: Handling different types of data differently<a class="anchor" aria-label="anchor" href="#option-2-handling-different-types-of-data-differently"></a>
</h2>
<p>Handling all types of data the same way, might be a bit too simple
for your usecase. In that case it’s possible to distinguish between the
different data types by checking for the value of
<code>table_name</code>. Depending on which type of data you get passed,
you can handle them completely different then.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://occupationMeasurement.github.io/occupationMeasurement/" class="external-link">occupationMeasurement</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to the database</span></span>
<span><span class="va">db_connection</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Launch the interactive app</span></span>
<span><span class="fu"><a href="../reference/app.html">app</a></span><span class="op">(</span></span>
<span>  start <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  app_settings <span class="op">=</span> <span class="fu"><a href="../reference/create_app_settings.html">create_app_settings</a></span><span class="op">(</span></span>
<span>    handle_data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">table_name</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># By checking for table_name we can identify which type of data is being handled</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">table_name</span> <span class="op">==</span> <span class="st">"results_overview"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Write data into the "results" table (creating it if necessary)</span></span>
<span>        <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbWriteTable</span><span class="op">(</span></span>
<span>          conn <span class="op">=</span> <span class="va">db_connection</span>,</span>
<span>          name <span class="op">=</span> <span class="st">"results"</span>,</span>
<span>          value <span class="op">=</span> <span class="va">data</span>,</span>
<span></span>
<span>          <span class="co"># Important, to actually add data and not remove any existing data.</span></span>
<span>          append <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">table_name</span> <span class="op">==</span> <span class="st">"answers"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Don't save answers data, just output it into the R console</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"'answers' data (not saved):"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co"># Ignoring any other type of data e.g. occupations_suggested</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Let's not save data in files, when we're already using a database</span></span>
<span>    save_to_file <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jan Simson, Olga Kononykhina, Malte Schierholz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
