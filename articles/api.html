<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using the API ‚Ä¢ occupationMeasurement</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using the API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">occupationMeasurement</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/occupationMeasurement.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/app.html">Using the Interactive App</a></li>
    <li><a class="dropdown-item" href="../articles/app-questionnaire.html">Custom Questionnaires / Pages</a></li>
    <li><a class="dropdown-item" href="../articles/app-database.html">Saving App Data in a Database</a></li>
    <li><a class="dropdown-item" href="../articles/app-deployment.html">Deploying to a Server / the Cloud</a></li>
    <li><a class="dropdown-item" href="../articles/api.html">Using the API</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/occupationMeasurement/occupationMeasurement/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Using the API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/occupationMeasurement/occupationMeasurement/blob/main/vignettes/api.Rmd" class="external-link"><code>vignettes/api.Rmd</code></a></small>
      <div class="d-none name"><code>api.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="starting-the-api">Starting the API<a class="anchor" aria-label="anchor" href="#starting-the-api"></a>
</h2>
<p>Starting the API is simple, as you will only need to call the
<code><a href="../reference/api.html">api()</a></code> method. This will immediately start a local plumber
server and will open a window with the API‚Äôs documentation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start the API (and open its documentation)</span></span>
<span><span class="fu">occupationMeasurement</span><span class="fu">::</span><span class="fu"><a href="../reference/api.html">api</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The API is designed to allow for similar usage as the interactive
application, but implementing the UI and its logic has to be done
manually. It is recommended to use the same text prompts as the shiny
application (<code><a href="../reference/app.html">app()</a></code>) for consistency.</p>
<p>A typical workflow for using the API is as follows:</p>
<ol style="list-style-type: decimal">
<li>Obtain a freetext response from the participant describing their
occupation and its tasks.</li>
<li>Send this freetext response to <code>/v1/suggestions</code> to get a
list of suggested categories.</li>
<li>Present this list to the participant for them choose an option.
(There should always be the option of indicating that none of the
suggested categories fit.)</li>
<li>If the suggested category has followup questions, retrieve the next
followup question from <code>/v1/next_followup_question</code> and
present it to the user. (It is technically possible to skip this step,
but the quality of the final codings would diminish.)</li>
<li>Use the code from the picked suggested category alongside the
responses to the followup questions to get the final occupation category
codes from <code>/v1/final_codes</code>.</li>
</ol>
<p>This is the simplest workflow possible; explore the app for our
recommended, more respondent-oriented workflows.</p>
<p>Each of the API endpoints comes with a set of options / parameters
which are described in the API‚Äôs documentation. The API documentation is
automatically available when starting the API, comes with the option to
test out endpoints and provides example code on how to query the
API.</p>
</div>
<div class="section level2">
<h2 id="interactive-documentation">Interactive Documentation<a class="anchor" aria-label="anchor" href="#interactive-documentation"></a>
</h2>
<p>The easiest way of understanding how the API works, is by starting it
locally via <code><a href="../reference/api.html">api()</a></code> and exploring the included Swagger
documentation that will open automatically. Using the UI one can
interactively explore different API endpoints, what input they expect
and what output they return.</p>
<p>The api also comes with an <a href="https://spec.openapis.org/oas/v3.0.3" class="external-link">openapi specification</a> at
the endpoint <code>/openapi.json</code>.</p>
</div>
<div class="section level2">
<h2 id="flow">Flow<a class="anchor" aria-label="anchor" href="#flow"></a>
</h2>
<p>Since the API has multiple endpoints to be called, it expects a
certain flow of how requests follow onto each other in order to properly
function.</p>
<p>The diagram below demonstrates a minimal version of this flow, with
different API endpoints highlighted in <strong>bold</strong>. More
complex scenarios are possible if you e.g.¬†implement multiple tries of
generating job suggestions for cases where user input was ambiguous.</p>
<blockquote>
<p>Note: This flow assumes that an ‚Äúauxco‚Äù-based suggestion-type is used
(the default), which also adds followup questions to be asked to
respondents. When using a different suggestion type, such as ‚Äúkldb-2010‚Äù
only the ‚Äú/get_suggestions‚Äù endpoint is necessary, but final encodings
might be of worse quality.</p>
</blockquote>
<div class="float">
<img src="../reference/figures/api_flow.svg" alt="A diagram showing the flow of different API requests onto each other"><div class="figcaption">A diagram showing the flow of different API
requests onto each other</div>
</div>
<p>For inspiration on how to implement the <em>user-facing</em> flow of
an application using the api, take a look at
<code><a href="../articles/app.html">vignette("app")</a></code> and refer to the interactive
<code><a href="../reference/app.html">app()</a></code> included in this package.</p>
</div>
<div class="section level2">
<h2 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a>
</h2>
<p>The API comes with a pre-built Docker image for easy deployment on a
server, your own computer or the cloud. If you wish to deploy the API
without using docker, information on how to deploy a <a href="https://www.rplumber.io" class="external-link">plumber</a> API can be found <a href="https://www.rplumber.io/articles/hosting.html" class="external-link">here</a>.</p>
<blockquote>
<p>Note that the <code><a href="../reference/api.html">api()</a></code> function will, by default,
immediately start the API instead of returning a plumber instance. If
you want to have access to the plumber instance for additional control
during deployment, you can get it by calling the API via
<code>api(start = FALSE)</code>.</p>
</blockquote>
<div class="section level3">
<h3 id="using-docker">Using Docker üê≥<a class="anchor" aria-label="anchor" href="#using-docker"></a>
</h3>
<p>For easy deployment of the app, the package comes with a pre-built
docker image called <a href="https://github.com/orgs/occupationMeasurement/packages/container/package/api" class="external-link"><code>ghcr.io/occupationmeasurement/api</code></a>.</p>
<p>To test this image on your local machine you can run the following
command in your command line (this assumses you have Docker
installed):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Start the api</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># it can be reached at http://localhost:8000</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># Swagger documentation can be viewed at http://localhost:8000/__docs__/</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">-p</span> 8000:8000 <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>/output:/output <span class="at">-e</span> ALLOW_ORIGIN=<span class="st">"*"</span> <span class="at">-e</span> REQUIRE_IDENTIFIER=TRUE ghcr.io/occupationmeasurement/api:latest</span></code></pre></div>
<p>For more detailed information on the docker images if you e.g.¬†want
to build your own refer to the <a href="https://github.com/occupationMeasurement/occupationMeasurement/tree/main/docker" class="external-link">docker
directory</a> in the repository.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Simson, Olga Kononykhina, Malte Schierholz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
